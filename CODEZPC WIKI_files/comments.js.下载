document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){if(window.i18n){document.querySelectorAll(".comments-section h3").forEach(el=>{if(el.textContent==="comments.title"){el.textContent=window.i18n.t("comments.title")}});document.querySelectorAll(".comment-form textarea").forEach(el=>{if(el.placeholder==="comments.write_placeholder"){el.placeholder=window.i18n.t("comments.write_placeholder")}});document.querySelectorAll(".comment-form button").forEach(el=>{if(el.textContent==="comments.post_button"){el.textContent=window.i18n.t("comments.post_button")}});document.querySelectorAll(".comment-form .form-help").forEach(el=>{if(el.textContent==="comments.markdown_supported"){el.textContent=window.i18n.t("comments.markdown_supported")}});document.querySelectorAll(".login-prompt").forEach(el=>{if(el.innerHTML.includes("comments.login_required")){el.innerHTML=window.i18n.t("comments.login_required")+' <a href="javascript:void(0)" class="open-login">'+window.i18n.t("comments.login")+"</a>"}});document.querySelectorAll(".no-comments").forEach(el=>{if(el.textContent==="comments.no_comments"){el.textContent=window.i18n.t("comments.no_comments")}});document.querySelectorAll(".delete-comment").forEach(el=>{if(el.title==="comments.delete_title"){el.title=window.i18n.t("comments.delete_title")}})}},500);const commentForm=document.getElementById("comment-form");if(commentForm){commentForm.addEventListener("submit",async function(e){e.preventDefault();const commentContent=this.querySelector('textarea[name="content"]').value;if(!commentContent.trim()){return}const docPath=getCurrentDocPath();try{const submitButton=this.querySelector('button[type="submit"]');const originalText=submitButton.textContent;submitButton.textContent=window.i18n?window.i18n.t("common.sending"):"Sending...";submitButton.disabled=true;const response=await fetch(`/api/comments/add/${docPath}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:commentContent})});if(response.ok){this.reset();window.location.reload()}else{const data=await response.json();showMessageDialog(window.i18n?window.i18n.t("comments.error_title"):"Error",data.message||(window.i18n?window.i18n.t("comments.error_generic"):"Failed to post comment"))}}catch(error){showMessageDialog(window.i18n?window.i18n.t("comments.error_title"):"Error",window.i18n?window.i18n.t("comments.error_generic"):"Failed to post comment");console.error("Error posting comment:",error)}finally{submitButton.textContent=originalText;submitButton.disabled=false}})}document.querySelectorAll(".delete-comment").forEach(button=>{button.addEventListener("click",function(){const commentId=this.dataset.id;const docPath=getCurrentDocPath();console.log("Delete button clicked for comment ID:",commentId);console.log("Current document path:",docPath);console.log("Showing confirmation dialog...");if(typeof window.showConfirmDialog==="function"){window.showConfirmDialog(window.i18n?window.i18n.t("comments.delete_title"):"Delete Comment",window.i18n?window.i18n.t("comments.delete_confirm"):"Are you sure you want to delete this comment? This action cannot be undone.",async confirmed=>{console.log("User response to delete confirmation:",confirmed);if(!confirmed)return;try{console.log("Sending delete request to:",`/api/comments/delete/${docPath}/${commentId}`);const response=await fetch(`/api/comments/delete/${docPath}/${commentId}`,{method:"DELETE"});console.log("Delete response status:",response.status);if(response.ok){console.log("Delete successful, removing comment from page");const comment=document.querySelector(`.user-comment[data-id="${commentId}"]`);if(comment){comment.remove();const commentsList=document.querySelector(".comments-list");if(commentsList&&!commentsList.querySelector(".user-comment")){const noComments=document.createElement("p");noComments.className="no-comments";noComments.textContent=window.i18n?window.i18n.t("comments.no_comments"):"No comments yet.";commentsList.appendChild(noComments)}}}else{console.error("Delete failed with status:",response.status);const data=await response.json();console.error("Error data:",data);if(typeof window.showMessageDialog==="function"){window.showMessageDialog(window.i18n?window.i18n.t("comments.error_title"):"Error",data.message||(window.i18n?window.i18n.t("comments.error_delete"):"Failed to delete comment"))}else{alert(data.message||(window.i18n?window.i18n.t("comments.error_delete"):"Failed to delete comment"))}}}catch(error){console.error("Exception during delete operation:",error);if(typeof window.showMessageDialog==="function"){window.showMessageDialog(window.i18n?window.i18n.t("comments.error_title"):"Error",window.i18n?window.i18n.t("comments.error_delete"):"Failed to delete comment")}else{alert(window.i18n?window.i18n.t("comments.error_delete"):"Failed to delete comment")}console.error("Error deleting comment:",error)}})}else{console.error("showConfirmDialog function not found, using alert instead");if(confirm(window.i18n?window.i18n.t("comments.delete_confirm"):"Are you sure you want to delete this comment? This action cannot be undone.")){fetch(`/api/comments/delete/${docPath}/${commentId}`,{method:"DELETE"}).then(response=>{if(response.ok){const comment=document.querySelector(`.user-comment[data-id="${commentId}"]`);if(comment){comment.remove();const commentsList=document.querySelector(".comments-list");if(commentsList&&!commentsList.querySelector(".user-comment")){const noComments=document.createElement("p");noComments.className="no-comments";noComments.textContent=window.i18n?window.i18n.t("comments.no_comments"):"No comments yet.";commentsList.appendChild(noComments)}}}else{alert(window.i18n?window.i18n.t("comments.error_delete"):"Failed to delete comment")}}).catch(error=>{console.error("Error deleting comment:",error);alert(window.i18n?window.i18n.t("comments.error_delete"):"Failed to delete comment")})}}})});const loginLink=document.querySelector(".login-prompt .open-login");if(loginLink){loginLink.addEventListener("click",function(e){e.preventDefault();showLoginDialog()})}});