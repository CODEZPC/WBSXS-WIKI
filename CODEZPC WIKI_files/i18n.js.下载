let translations={};let currentLanguage=document.documentElement.lang||"en";async function initTranslations(){try{currentLanguage=document.documentElement.lang||"en";await loadTranslations(currentLanguage);applyTranslations();setupMutationObserver();console.log(`Translations initialized for language: ${currentLanguage}`)}catch(error){console.error("Failed to initialize translations:",error)}}function setupMutationObserver(){const observer=new MutationObserver(mutations=>{let needsTranslation=false;mutations.forEach(mutation=>{if(mutation.type==="childList"){mutation.addedNodes.forEach(node=>{if(node.nodeType===1){if(node.hasAttribute&&node.hasAttribute("data-i18n")){needsTranslation=true}const elementsWithI18n=node.querySelectorAll?node.querySelectorAll("[data-i18n]"):[];if(elementsWithI18n.length>0){needsTranslation=true}}})}});if(needsTranslation){applyTranslations()}});observer.observe(document.body,{childList:true,subtree:true})}async function loadLanguageData(lang){try{const response=await fetch(`/static/langs/${lang}.json`);if(!response.ok){throw new Error(`Failed to load translations for ${lang}: ${response.status}`)}return await response.json()}catch(error){console.error(`Error loading translations for ${lang}:`,error);return{}}}const languageCache={};async function loadTranslations(lang){try{if(!languageCache[lang]){languageCache[lang]=await loadLanguageData(lang)}translations=languageCache[lang]}catch(error){console.error(`Error loading translations for ${lang}:`,error);translations={}}}function t(key,lang){if(lang&&lang!==currentLanguage){if(languageCache[lang]){return languageCache[lang][key]||key}}return translations[key]||key}function applyTranslations(){document.querySelectorAll("[data-i18n]").forEach(element=>{const key=element.getAttribute("data-i18n");if(key){element.textContent=t(key)}})}function translateElement(element){if(element.hasAttribute&&element.hasAttribute("data-i18n")){const key=element.getAttribute("data-i18n");if(key){element.textContent=t(key)}}const children=element.querySelectorAll?element.querySelectorAll("[data-i18n]"):[];children.forEach(child=>{const key=child.getAttribute("data-i18n");if(key){child.textContent=t(key)}})}document.addEventListener("DOMContentLoaded",initTranslations);window.i18n={t:t,loadTranslations:loadTranslations,applyTranslations:applyTranslations,translateElement:translateElement,getCurrentLanguage:()=>currentLanguage,setCurrentLanguage:async lang=>{currentLanguage=lang;await loadTranslations(lang);applyTranslations()}};