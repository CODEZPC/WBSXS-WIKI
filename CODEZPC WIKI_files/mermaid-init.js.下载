window.MermaidHandler={initMain:function(){if(typeof mermaid==="undefined"){console.error("Mermaid library not loaded");return}try{const isDarkMode=document.documentElement.getAttribute("data-theme")==="dark";this._storeOriginalSources();mermaid.initialize({startOnLoad:true,theme:isDarkMode?"dark":"default",securityLevel:"strict",maxTextSize:15e3,fontFamily:"system-ui, -apple-system, sans-serif"});console.log("Mermaid initialized for main document");this._setupThemeChangeListeners()}catch(error){console.error("Failed to initialize Mermaid:",error)}},initVersionPreview:function(container){if(!container||typeof mermaid==="undefined"){console.error("Invalid container or Mermaid not loaded");return}try{console.log("Initializing Mermaid for version preview");const isDarkMode=document.documentElement.getAttribute("data-theme")==="dark";mermaid.initialize({startOnLoad:false,theme:isDarkMode?"dark":"default",securityLevel:"strict",maxTextSize:15e3,fontFamily:"system-ui, -apple-system, sans-serif"});const diagrams=container.querySelectorAll(".mermaid");if(diagrams.length===0){console.log("No mermaid diagrams found in preview");return}diagrams.forEach((diagram,index)=>{const id=`mermaid-preview-${index}-${Date.now()}`;try{const source=diagram.textContent||diagram.innerText;if(!source||source.trim()===""){console.warn("Empty diagram source found");return}mermaid.render(id,source).then(result=>{diagram.innerHTML=result.svg;console.log(`Diagram ${index} rendered successfully`)}).catch(err=>{console.error(`Failed to render diagram ${index}:`,err);diagram.innerHTML=`<div style="color:red;border:1px solid red;padding:10px;">
                Diagram rendering error: ${err.message}
              </div>`})}catch(err){console.error(`Error processing diagram ${index}:`,err);diagram.innerHTML=`<div style="color:red;border:1px solid red;padding:10px;">
            Error: ${err.message}
          </div>`}})}catch(error){console.error("Error initializing for version preview:",error)}},_setupThemeChangeListeners:function(){document.addEventListener("themeChanged",event=>{if(!window.isPrintActive){this._rerenderDiagrams(event.detail.theme)}})},_rerenderDiagrams:function(newTheme){if(typeof mermaid==="undefined"){console.error("Mermaid library not loaded");return}try{mermaid.initialize({startOnLoad:false,theme:newTheme==="dark"?"dark":"default",securityLevel:"strict",maxTextSize:15e3,fontFamily:"system-ui, -apple-system, sans-serif"});const diagrams=document.querySelectorAll(".mermaid");const renderPromises=[];diagrams.forEach((diagram,index)=>{const source=diagram.dataset.mermaidSource;if(!source||source.trim()===""){console.warn("No source found for diagram",index);return}const id=`mermaid-${index}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;diagram.classList.add("mermaid-rerendering");const renderPromise=mermaid.render(id,source).then(result=>{diagram.innerHTML=result.svg;diagram.classList.remove("mermaid-rerendering");console.log(`Diagram ${index} re-rendered with ${newTheme} theme`)}).catch(err=>{console.error(`Failed to re-render diagram ${index}:`,err);diagram.innerHTML=`<div style="color:red;border:1px solid red;padding:10px;">
              Re-rendering error: ${err.message}
            </div>`;diagram.classList.remove("mermaid-rerendering")});renderPromises.push(renderPromise)});Promise.allSettled(renderPromises).then(()=>{console.log(`Completed re-rendering ${diagrams.length} mermaid diagrams with ${newTheme} theme`)})}catch(error){console.error("Error re-rendering mermaid diagrams:",error)}},_storeOriginalSources:function(){const diagrams=document.querySelectorAll(".mermaid");diagrams.forEach(diagram=>{if(!diagram.dataset.mermaidSource){const source=(diagram.textContent||diagram.innerText).trim();if(source){diagram.dataset.mermaidSource=source}}})}};document.addEventListener("DOMContentLoaded",function(){window.MermaidHandler.initMain()});