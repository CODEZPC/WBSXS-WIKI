const WikiSearch=function(){let searchBox;let searchResults;let searchResultsContent;let searchClose;let searchTimeout;function init(){searchBox=document.querySelector(".search-box");searchResults=document.querySelector(".search-results");searchResultsContent=document.querySelector(".search-results-content");searchClose=document.querySelector(".search-close");bindEvents()}function bindEvents(){searchBox.addEventListener("input",function(e){clearTimeout(searchTimeout);const query=e.target.value.trim();if(!query){searchResults.classList.remove("active");return}searchTimeout=setTimeout(()=>{performSearch(query)},300)});searchClose.addEventListener("click",function(){searchResults.classList.remove("active");searchBox.value=""})}async function performSearch(query){try{const response=await fetch("/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:query})});if(!response.ok){throw new Error("Search failed")}const results=await response.json();console.log("Search results:",results);const resultsArray=Array.isArray(results)?results:[];displaySearchResults(resultsArray,query)}catch(error){console.error("Search error:",error);searchResultsContent.innerHTML='<div class="empty-message">An error occurred while searching. Please try again.</div>'}}function displaySearchResults(results,query){searchResults.classList.add("active");if(!Array.isArray(results)||results.length===0){searchResultsContent.innerHTML='<div class="empty-message">'+(window.i18n?window.i18n.t("search.no_results"):"No results found.")+"</div>";return}const terms=[];let match;const quotedRegex=/"([^"]+)"/g;const remainingTerms=query.split(/\s+/).filter(term=>term&&!term.startsWith("NOT")&&!term.includes('"'));while((match=quotedRegex.exec(query))!==null){terms.push(match[1].replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))}terms.push(...remainingTerms.map(term=>term.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")));const pattern=new RegExp(`(${terms.join("|")})`,"gi");const html=results.map(result=>{const highlightedTitle=result.title.replace(pattern,'<span class="search-result-highlight">$1</span>');const highlightedExcerpt=result.excerpt.replace(pattern,'<span class="search-result-highlight">$1</span>');return`
                <div class="search-result-item">
                    <a href="${result.path}" class="search-result-title">${highlightedTitle}</a>
                    <div class="search-result-path">${result.path}</div>
                    <div class="search-result-excerpt">${highlightedExcerpt}</div>
                </div>
            `}).join("");searchResultsContent.innerHTML=html}function hideSearchResults(){if(searchResults){searchResults.classList.remove("active");if(searchBox){searchBox.value=""}}}return{init:init,performSearch:performSearch,hideSearchResults:hideSearchResults}}();window.Search={hideSearchResults:function(){const searchResults=document.querySelector(".search-results");const searchBox=document.querySelector(".search-box");if(searchResults){searchResults.classList.remove("active");if(searchBox){searchBox.value=""}}}};document.addEventListener("DOMContentLoaded",function(){WikiSearch.init()});